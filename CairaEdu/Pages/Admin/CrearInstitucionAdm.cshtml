@page
@model CairaEdu.Pages.Admin.CrearInstitucionAdmModel
@{
	Layout = "~/Pages/Shared/_AdminLayout.cshtml";
}

<h2 class="mb-4 text-center">Institución</h2>
<!-- Formulario Institución -->
<div class="card mb-4">
	<div class="card-header bg-success text-white"></div>
	<div class="card-body">
		<form method="post" enctype="multipart/form-data">

			<div class="row mb-3">
				<div class="col-md-4">
					<label for="inst_Logo" class="form-label">Logo/Escudo Institucional</label>
					<input asp-for="Input.Logo" type="file" class="form-control" />

					<!-- Previsualización -->
					@*ORGANIZAR ESTO PARA LA PREVISUALIZACI[ON DEL LOGO, LO PIDE EL PROFESOR QUE VA A REVISAR*@
					<div class="border rounded p-2 text-center" style="height: 200px; width: 200px;">
						@* <img id="previewLogo"
                                 src="@(Model.logobase64 != null ? $"data:image/png;base64,{Model.logobase64}" : "#")"
                                 alt="Logo de la institución"
                                 style="max-height: 120px; max-width: 100%; @(Model.logobase64 != null ? "" : "display: none;")" /> *@
					</div>
				</div>

				<div class="col-md-8">
					<label for="inst_Nombre" class="form-label">Nombre de la Institución</label>
					<input asp-for="Input.Nombre" class="form-control" required />
					<label for="inst_direccion" class="form-label" style="margin-top: 15px;">Dirección</label>
					<input asp-for="Input.Direccion" class="form-control" required />
					<div class="col-md-12" style="margin-top: 15px;">
						<input asp-for="Input.Dominio" class="form-control" placeholder="ej: miinstitucion" required />
						<small class="text-muted">Se agregará automáticamente <code>.edu.ec</code></small>
					</div>
				</div>

				<div class="row mb-3">

					<div class="col-md-3" style="margin-top:15px">
						<label for="inst_ruc" class="form-label">RUC</label>
						<input asp-for="Input.Ruc" class="form-control" maxlength="13" required />
					</div>
					<div class="col-md-3" style="margin-top:15px">
						<label for="inst_telefono" class="form-label">Teléfono</label>
						<input asp-for="Input.Telefono"class="form-control" maxlength="10" required>
					</div>
					<div class="col-md-3" style="margin-top:15px">
						<label for="ProvinciaId" class="form-label">Provincia</label>
						<select asp-for="Input.ProvinciaId" class="form-select" asp-items="Model.Provincias" id="provincia-select">
							<option value="">Seleccione</option>
						</select>	
					</div>
					<div class="col-md-3" style="margin-top:15px">
						<label for="CiudadId" class="form-label">Ciudad</label>
						<select asp-for="Input.CiudadId" class="form-select" asp-items="Model.Ciudades" id="ciiudad-select">
							<option value="">Seleccione</option>
						</select>
					</div>
				</div>

				<div class="text-end">
					<button type="submit" class="btn btn-success">Guardar</button>
					<button type="reset" class="btn btn-secondary">Limpiar</button>
				</div>
		</form>
		<partial name="_ValidationScriptsPartial" />
		<vc:validation-summary model-only="true" />

	</div>


	@section Scripts {
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script>
			$(document).ready(function () {
				$('#provincia-select').change(function () {
					var provinciaId = $(this).val();
					var ciudadSelect = $('#ciudad-select');
					ciudadSelect.empty(); // Limpiar las ciudades anteriores
					ciudadSelect.append($('<option>', { value: '', text: 'Seleccione' }));

					if (provinciaId) {
						$.getJSON('/Admin/CrearInstitucionAdm?handler=CiudadesPorProvincia', { provinciaId: provinciaId }, function (data) {
							$.each(data, function (i, ciudad) {
								ciudadSelect.append($('<option>', {
									value: ciudad.ciudadId,
									text: ciudad.nombre
								}));
							});
						});
					}
				});
			});
		</script>
	}
